<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciamento de Produtos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-5">

<h1 class="mb-4 text-center">Gerenciamento de Produtos</h1>

<div class="card p-3 mb-4">
    <h4>Cadastrar Produto</h4>
    <input id="nome" class="form-control mb-2" placeholder="Nome">
    <input id="preco" class="form-control mb-2" placeholder="Preço" type="number" step="0.01">
    <button class="btn btn-primary w-100" onclick="createProduct()">Salvar</button>
</div>

<h3>Lista de Produtos</h3>
<table class="table table-striped" id="produtosTable">
    <thead>
    <tr>
        <th>ID</th>
        <th>Nome</th>
        <th>Preço</th>
        <th>Ações</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
    const apiUrl = "http://localhost:8080/produtos";

    function loadProducts() {
        fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
                const tbody = document.querySelector("#produtosTable tbody");
                tbody.innerHTML = "";

                data.forEach(p => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${p.id}</td>
                            <td><input id="nome-${p.id}" class="form-control" value="${p.nome}"></td>
                            <td><input id="preco-${p.id}" class="form-control" type="number" value="${p.preco}" step="0.01"></td>
                            <td>
                                <button class="btn btn-success btn-sm" onclick="updateProduct(${p.id})">Salvar</button>
                                <button class="btn btn-danger btn-sm" onclick="deleteProduct(${p.id})">Excluir</button>
                            </td>
                        </tr>
                    `;
                });
            });
    }

    function createProduct() {
        const nome = document.getElementById("nome").value;
        const preco = document.getElementById("preco").value;

        fetch(apiUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ nome, preco })
        }).then(() => {
            document.getElementById("nome").value = "";
            document.getElementById("preco").value = "";
            loadProducts();
        });
    }

    function updateProduct(id) {
        const nome = document.getElementById(`nome-${id}`).value;
        const preco = document.getElementById(`preco-${id}`).value;

        fetch(`${apiUrl}/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ nome, preco })
        }).then(() => loadProducts());
    }

    function deleteProduct(id) {
        if (!confirm("Tem certeza que deseja excluir?")) return;

        fetch(`${apiUrl}/${id}`, {
            method: "DELETE"
        }).then(() => loadProducts());
    }

    loadProducts();
</script>

</body>
</html>
